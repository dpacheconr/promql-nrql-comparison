# Sample External Secrets using Kubernetes provider (more stable than fake provider)
# This demonstrates External Secrets Operator syncing from Kubernetes secrets
---
apiVersion: v1
kind: Secret
metadata:
  name: source-secret
  namespace: monitoring
type: Opaque
stringData:
  demo-key: "demo-value-from-k8s-secret"
  api-key: "fake-api-key-12345"
  database-password: "fake-db-password"

---
# SecretStore using Kubernetes secrets as backend
apiVersion: external-secrets.io/v1
kind: SecretStore
metadata:
  name: k8s-secret-store
  namespace: monitoring
spec:
  provider:
    kubernetes:
      remoteNamespace: monitoring
      server:
        caProvider:
          type: ConfigMap
          name: kube-root-ca.crt
          key: ca.crt
      auth:
        serviceAccount:
          name: external-secrets

---
# Sample ExternalSecret syncing from Kubernetes secret
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: demo-external-secret
  namespace: monitoring
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: k8s-secret-store
    kind: SecretStore
  target:
    name: demo-secret-from-external
    creationPolicy: Owner
  data:
    - secretKey: demo-key
      remoteRef:
        key: source-secret
        property: demo-key
    - secretKey: api-key
      remoteRef:
        key: source-secret
        property: api-key
